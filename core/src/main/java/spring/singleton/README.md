# Singleton

## In web application

　스프링없이 순수한 DI 컨테이너의 경우 AppConfig는 요청을 받을 때마다 객체를 새롭게 생성하게된다.
즉, 한 두개가 아닌 수십 수백개라면 계속해서 새로운 객체가 만들어지기에 메모리 낭비가 심해진다.
그렇기에 객체를 하나만 생성해두고 이를 공유하도록 하면 이 낭비를 줄일 수 있게 된다.(SingletonTest 참조)

## Singleton pattern

　클래스 인스턴스가 1개만 생성하는 것을 보장하는 패턴이다. 즉, 같은 타입의 인스턴스를 2개이상 못만들도록 하는 것이다
- getInstance를 통해 메서드를 조회하며, 생성된 객체를 사용자에게 전달해준다
- 1개의 instance만 존재해야하므로, 외부에서 new 생성자를 호출할 수 없도록 private을 이용해 생성자를 감춰둔다

> Singleton pattern을 구현하는 방법은 여러가지가 있으며, 여기선 가장 단순하고 안전한 방법으로 테스트를 구현했다.

- 단점
  - Singleton pattern 클래스를 구현하는 코드를 구현해줘야한다
  - 클라이언트가 구체클래스에 의존하게 된다 (DIP 위반)
  - private 생성자로 자식 클래스 만들기가 어렵다
  - 유연성이 떨어져서 테스트나 내부 속성을 변경하기 어렵다

## Spring Container

　스프링 컨테이너는 싱글톤패턴의 문제를 해결하면서, 객체 인스턴스를 1개로 생성 및 관리한다.
- 우리가 Bean annotation을 통해 만든 Bean이 싱글톤으로 만들어진 것이다
- 우리가 Bean객체를 만들 때, 스프링 컨테이너의 빈 저장소에 객체를 생성하고 저장해두고 관리한다
- 즉, 스프링 컨테이너는 싱글톤 컨테이너 역할을 하며 이러한 기능을 **싱글톤 레지스트리**라고 한다.

즉, 스프링 컨테이너 별도의 코드 없이 싱글톤 패턴을 구현할 수 있다!

> 물론 스프링 빈 등록 방식이 디폴트는 싱글톤이지만, 요청시 새로운 객체를 생성하는 기능 또한 제공한다.

## Singleton의 주의점

　싱글톤 패턴, 싱글톤 컨테이너, 스프링 컨테이너과 같은 객체를 하나만 생성하여 공유한다.
따라서 상태를 유지, 저장하게 설계해서는 안되며 무상태로 설계를 해야한다.
- 특정 클라이언트에 의존적인 필드가 존재해선 안된다
- 특정 클라이언트가 값을 변경할 수 있으면 안된다
- 가급적으로 읽기만 가능해야한다. 즉 가급적 수정이 되면 안된다.
- 공유되지 않는 값인 지역변수, 파라미터, ThreadLocal 등을 사용해야한다
- 공유 값 설정시 큰 문제가 발생한다!!
- 스프링은 항상 무상태로 설계해야한다!!


