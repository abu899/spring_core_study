# Bean 생명주기 콜백

## Lifecycle 시작

　DB커넥션 풀이나 소켓과 같이 시작시 미리 연결해두고 종료시점에 연결을 해제해주는 작업이 자주 발생한다.
 객체의 초기화 작업과 종료작업을 진행하는 방법에 대해 알아보자  
 
스프링 빈은 다음과 같은 라이프 사이클을 가진다
- 객체 생성 -> 의존 관계 주입
- 생성자 주입 예외

초기화 작업의 경우 의존관계 주입이 완료된 다음에 진행해야하는데, 만약 자동 의존관계 주입을 한다면 언제 완료됬는지
알 수 있을까?
- 스프링은 콜백 메서드를 통해 초기화 시점을 알려주는 다양한 기능 제공!
- 또한 스프링 컨테이너가 종료되기 전에 소멸 콜백을 제공한다!(싱글톤 컨테이너)

스프링 빈의 이벤트 라이프 사이클
1. 스프링 컨테이너 생성
2. 스프링 빈 생성
3. 의존관계 주입
4. 초기화 콜백
5. 사용
6. 소멸 전 콜백
7. 스프링 종료

> 왜 생성자에 초기화 값을 넣어주지 않을까?  
> 　생성자는 파라미터를 받고 메모리를 할당하여 객체를 생성하는 책임을 가진다.
> 하지만 초기화의 경우 생성된 객체를 활용하여 여러 동작을 수행한다.  
> 　따라서 생성자와 초기화를 분리하여 역할을 명확하게 나누는게 유지보수 관점에서 좋다!
> 다만 초기화 작업이 단순히 값을 변경하는 정도라면 생성자에서 처리하는 것도 고려할 수 있다.

스프링은 3가지 방법으로 빈 생명주기 콜백을 지원한다
1. 인터페이스(Initializing Bean, DisposalBean)
   - 단점
     - 스프링 전용 인터페이스이기 떄문에 해당 코드가 스프링 전용 인터페이스에 의존한다
     - 초기화 및 소멸 메서드의 이름을 변경 불가능하다
     - 외부 라이브러리에 의존
   - 인터페이스를 사용하는 초기화는 요즘은 잘 사용하지 않음
2. 빈 등록 초기화, 소멸 메서드
   - 설정 정보에 initMethod, destroyMethod 등을 지정
   - 메서드 이름을 자유롭게 줄수 있다.
   - 또한 스프링 코드에 의존하지 않는다.
   - 설정 정보를 사용하기 때문에, **외부 라이브러리에도 초기화 및 종료 메서드를 지정할 수 있다**!
   - destroyMethod
     - 추론 기능이 적용되어 있다
     - 라이브러리 대부분이 shutdown, close라는 이름으로 종료 메서드가 지정되어 있고 이를 추론해서 자동으로 적용된다.
     - 따라서 위 두가지 이름으로 종료 메서드를 만들경우 자동으로 호출이 된다
     - 위 기능을 적용하기 싫다면 빈 공백으로 지정해줘야한다(destroyMethod="")
3. Annotation으로 적용하는 방법
   - 결론적으로 이걸로 사용하면 된다 ^.^
   - PostConstruct, PreDestory
   - javax annotation이기 때문에 스프링에 의존적이지 않고 자바 표준임!
   - 컴포넌트 스캔과 잘 어울린다
   - 단점
     - 외부 라이브러리에 적용 불가능하다
     - 따라서 외부 라이브러리의 초기화가 필요한 경우에는 2번 방법을 사용하자
